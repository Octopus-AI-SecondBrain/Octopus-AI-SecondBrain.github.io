<!DOCTYPE html>
<html>
<head>
    <title>SecondBrain Debug</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .log { margin: 5px 0; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
    </style>
</head>
<body>
    <h1>üß† SecondBrain Frontend Debug</h1>
    <div id="logs"></div>
    
    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
        }
        
        async function runDiagnostics() {
            log('=== SecondBrain Frontend Diagnostics ===');
            
            // Check if config is loaded
            if (window.SECONDBRAIN_CONFIG) {
                log(`‚úÖ Config loaded: ${JSON.stringify(window.SECONDBRAIN_CONFIG)}`, 'success');
            } else {
                log('‚ùå Config not loaded', 'error');
            }
            
            // Check localStorage
            const token = localStorage.getItem('sb_token');
            if (token) {
                log(`‚úÖ Token found in localStorage: ${token.substring(0, 50)}...`, 'success');
            } else {
                log('‚ÑπÔ∏è No token in localStorage', 'info');
            }
            
            // Test backend connection
            try {
                log('Testing backend connection...');
                const response = await fetch('http://localhost:8000/');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Backend connected: ${JSON.stringify(data)}`, 'success');
                } else {
                    log(`‚ùå Backend error: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Backend connection failed: ${error.message}`, 'error');
            }
            
            // Test authentication if token exists
            if (token) {
                try {
                    log('Testing authentication with stored token...');
                    const response = await fetch('http://localhost:8000/auth/me', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (response.ok) {
                        const user = await response.json();
                        log(`‚úÖ Authentication valid: ${JSON.stringify(user)}`, 'success');
                    } else {
                        log(`‚ùå Token invalid: ${response.status}`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå Auth test failed: ${error.message}`, 'error');
                }
            }
            
            // Check if we should redirect
            if (!token) {
                log('‚ÑπÔ∏è No valid token, should redirect to auth.html', 'info');
                log('Click here to go to auth page: <a href="./auth.html" style="color: #0ff;">Auth Page</a>');
            } else {
                log('‚ÑπÔ∏è Token exists, should show main app', 'info');
                log('Click here to go to main app: <a href="./index.html" style="color: #0ff;">Main App</a>');
            }
        }
        
        // Load config first
        const script = document.createElement('script');
        script.src = './config.js';
        script.onload = () => {
            setTimeout(runDiagnostics, 100);
        };
        script.onerror = () => {
            log('‚ùå Failed to load config.js', 'error');
            runDiagnostics();
        };
        document.head.appendChild(script);
    </script>
</body>
</html>