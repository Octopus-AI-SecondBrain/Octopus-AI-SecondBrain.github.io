<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SecondBrain Map</title>
  <link rel="stylesheet" href="./styles.css" />
  <!-- Debug logging -->
  <script>
    console.log('ðŸ§  SecondBrain starting up...');
    console.log('Current URL:', window.location.href);
    console.log('LocalStorage token:', localStorage.getItem('sb_token') ? 'EXISTS' : 'NONE');
  </script>
  <!-- Configuration -->
  <script src="./config.js"></script>
  <!-- Cytoscape CDN -->
  <script defer src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <!-- Three.js for 3D visualization - using a stable version -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Create OrbitControls manually since CDN version might not work
    window.addEventListener('DOMContentLoaded', function() {
      console.log('THREE.js loaded:', typeof THREE !== 'undefined');
      
      // Simple OrbitControls-like functionality
      if (typeof THREE !== 'undefined' && !THREE.OrbitControls) {
        console.log('Creating fallback OrbitControls');
        // We'll handle this in the app.js with our fallback implementation
      }
    });
  </script>
  <script defer src="./app.js"></script>
</head>
<body>
  <!-- Animated background particles -->
  <div class="floating-particles" id="particles"></div>
  
  <header class="sb-header">
    <div class="brand">ðŸ§  SecondBrain Neural Map</div>
    <div class="demo-info" style="color: var(--accent); font-size: 12px; opacity: 0.8;">
      octopus : your AI second brain 
    </div>
    <div class="env">
      <label>Backend URL</label>
      <input id="backendUrl" type="text" placeholder="http://localhost:8000" />
      <button id="saveBackendUrl">Save</button>
    </div>
  </header>

  <main class="sb-main">
    <aside class="sidebar">
      <section class="card">
        <h3>ðŸš€ Demo Login</h3>
        <p class="muted">Welcome to SecondBrain Neural Map! Demo credentials are pre-filled.</p>
        <div class="row">
          <input id="username" type="text" placeholder="username" value="noel" />
          <input id="password" type="password" placeholder="password" value="secret123" />
        </div>
        <div class="row">
          <button id="btnLogin">Login</button>
          <button id="btnLogout" class="ghost">Logout</button>
        </div>
        <p class="muted" id="authStatus">Not authenticated</p>
      </section>

      <section class="card">
        <h3>Map Controls</h3>
        <div class="row">
          <label class="checkbox">
            <input id="toggle3D" type="checkbox" />
            3D Neural Map
          </label>
        </div>
        <label>Min similarity: <span id="simVal">0.45</span></label>
        <input id="minSim" type="range" min="0" max="1" step="0.01" value="0.45" />
        <label>Top-K per node: <span id="kVal">3</span></label>
        <input id="topK" type="range" min="1" max="20" step="1" value="3" />
        <label>Max nodes: <span id="maxNodesVal">200</span></label>
        <input id="maxNodes" type="range" min="2" max="2000" step="1" value="200" />
        <div class="row">
          <label class="checkbox">
            <input id="includeIsolates" type="checkbox" checked />
            Include isolates
          </label>
        </div>
        <div class="row">
          <button id="btnRefresh">Refresh Map</button>
          <button id="btnToggleLayout">Tree Layout</button>
        </div>
        <div class="row">
          <label class="checkbox">
            <input id="autoRotate3D" type="checkbox" />
            Auto-Rotate 3D (or press R)
          </label>
        </div>
        <p class="muted">ðŸ’¡ 3D Controls: Click 3D area first! WASD/Arrows to move, QE/Space/Shift for up/down, Right-click drag to pan, Shift+drag nodes to move them, R for auto-rotate, C to reset camera</p>
      </section>

      <section class="card">
        <h3>Search Notes</h3>
        <div class="row">
          <input id="searchQuery" type="text" placeholder="e.g., business idea" />
          <button id="btnSearch">Search</button>
        </div>
        <div id="searchResults" class="list"></div>
      </section>

      <section class="card">
        <h3>Bulk Import Notes</h3>
        <div class="row">
          <label for="bulkImport" class="file-label">
            ðŸ“± Import from Apple Notes
            <input id="bulkImport" type="file" accept=".txt,.md,.rtf,.csv,.json" multiple style="display:none;" />
          </label>
        </div>
        <div class="row">
          <textarea id="bulkText" rows="8" placeholder="Or paste multiple notes here... Separate notes with '---' on its own line"></textarea>
        </div>
        <div class="row">
          <button id="btnBulkImport">Import All Notes</button>
        </div>
        <p class="muted">Supported: Apple Notes export (.txt), plain text, markdown. Each note should be separated by '---'</p>
      </section>

      <section class="card">
        <h3>Create Single Note</h3>
        <div class="row">
          <input id="noteTitle" type="text" placeholder="Title" />
        </div>
        <div class="row">
          <textarea id="noteContent" rows="5" placeholder="Content"></textarea>
        </div>
        <div class="row">
          <button id="btnCreateNote">Create</button>
        </div>
        <p class="muted">Notes are auto-embedded and will appear in the map after creation.</p>
      </section>
    </aside>

    <section class="canvas">
      <div id="cy"></div>
      <div id="threeContainer" style="display:none;"></div>
      <div id="tooltip" class="tooltip hidden"></div>
      <div class="controls-hint">
        ðŸ’¡ Hover nodes to explore â€¢ Double-click to focus â€¢ Right-click to change layout â€¢ Toggle 3D for immersive view
      </div>
    </section>
  </main>
</body>
</html>